
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üåê Reliable All‚Äëin‚ÄëOne Downloader</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <div class="container widget-box">
    <h2>üåê Reliable All‚Äëin‚ÄëOne Downloader</h2>
    <p>Paste any video link (YouTube, Facebook, Drive) or a direct file link.</p>

    <div class="form-group">
      <label>URL</label>
      <input id="url" type="text" placeholder="Paste your video or file URL here" />
    </div>

    <div class="form-group">
      <label>Save As</label>
      <input id="filename" type="text" placeholder="e.g., my_video" value="downloaded_media" />
    </div>

    <div class="form-group">
      <label>Format</label>
      <div class="toggle">
        <button id="btnVideo" class="toggle-btn active" data-mode="video">Video</button>
        <button id="btnAudio" class="toggle-btn" data-mode="audio">Audio (MP3)</button>
      </div>
    </div>

    <button id="startBtn" class="primary">Start Download</button>

    <div id="status" class="status-message status-info" style="display:none;"></div>

    <div id="progressBox" class="progress-container" style="display:none;">
      <div id="progressBar" class="progress-bar">Working‚Ä¶</div>
    </div>

    <div id="result"></div>

    <div class="tabs">
      <div class="tab-title">Logs & Tips</div>
      <pre class="log-output-area" id="logs">Logs will appear here after completion.</pre>
    </div>
  </div>

<script>
let mode = "video";
const urlEl = document.getElementById("url");
const nameEl = document.getElementById("filename");
const btnVideo = document.getElementById("btnVideo");
const btnAudio = document.getElementById("btnAudio");
const statusEl = document.getElementById("status");
const progressBox = document.getElementById("progressBox");
const progressBar = document.getElementById("progressBar");
const resultEl = document.getElementById("result");
const startBtn = document.getElementById("startBtn");
const logsEl = document.getElementById("logs");

btnVideo.addEventListener("click", () => {
  mode = "video";
  btnVideo.classList.add("active");
  btnAudio.classList.remove("active");
});
btnAudio.addEventListener("click", () => {
  mode = "audio";
  btnAudio.classList.add("active");
  btnVideo.classList.remove("active");
});

function showStatus(html, cls="status-info") {
  statusEl.style.display = "block";
  statusEl.className = "status-message " + cls;
  statusEl.innerHTML = html;
}

function setProgress(active) {
  progressBox.style.display = active ? "block" : "none";
}

async function startDownload() {
  resultEl.innerHTML = "";
  logsEl.textContent = "Starting download‚Ä¶";
  showStatus("<i>Initiating download‚Ä¶</i>", "status-info");
  setProgress(true);
  startBtn.disabled = true;

  const url = urlEl.value.trim();
  const filename = nameEl.value.trim();

  if (!url || !filename) {
    showStatus("<b>Error:</b> Please provide both a URL and a 'Save As' filename.", "status-error");
    setProgress(false);
    startBtn.disabled = false;
    return;
  }

  try {
    const res = await fetch("/api/download", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ url, filename, mode })
    });
    const data = await res.json();

    if (!data.ok) {
      showStatus("<b>Download Error:</b> " + (data.error || "Unknown error."), "status-error");
      logsEl.textContent = (data.error || "No details.");
      setProgress(false);
      startBtn.disabled = false;
      return;
    }

    showStatus("<b>Download successful!</b> File is ready.", "status-success");
    logsEl.textContent = "Downloaded file: " + data.file + "\nSize: " + data.size + " bytes";

    // Create final download link
    resultEl.innerHTML = `
      <a class="download-final-button" href="${data.download_url}">
        Click Here to Download "${data.file}"
      </a>
    `;
  } catch (e) {
    showStatus("<b>Unexpected error:</b> " + e.message, "status-error");
    logsEl.textContent = (e && e.stack) ? e.stack : String(e);
  } finally {
    setProgress(false);
    startBtn.disabled = false;
  }
}

startBtn.addEventListener("click", startDownload);
</script>
</body>
</html>
